<!-- Generated by Heapkeeper v0.4 on 2010-04-10 13:44:39 -->
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
    <title>Thread hh/37</title>
    <link rel=stylesheet href="../heapindex.css" type="text/css">
  </head>
  <body>
    <h1 id="header">Thread hh/37</h1>


<div class="postbox"><!-- post hh/37 -->
<span class="postsummary" id="post_hh/37">
<span class="author">Csaba Hoch</span>
<span class="subject">Developing with vim</span>
<span class="tags">[reviewed, vim]</span>
<span class="index"><a href="../hh/thread_37.html#post_hh/37">&lt;hh/37&gt;</a></span>
<span class="parent">&lt;root&gt;</span>
<span class="date">(2009-03-22)</span>
<div class="body">
<pre class="postbody">In this thread, we could discuss developing Hm with Vim. It could
contain small tips or larger essays as well. E.g. I'd like to read a
howto sometime for using ctags with Vim and Python.


== For Python programming ==

* Executing the tests with :make. When pressing F1, it runs the tests
  and jumps to the last function call in the stack trace.

    " Place in some global place, e.g. your vimrc.
    set makeprg=./test.py

    " These should be executed for all Python buffers.
    " (E.g. place them in ~/.vim/ftplugin/python.vim.)
    setlocal errorformat=\ \ File\ \"%f\"\\,\ line\ %l\\,\ %m
    noremap &lt;buffer&gt; &lt;F1&gt; :make &lt;bar&gt; cw &lt;bar&gt; silent! 999cn&lt;cr&gt;

* Getting gD ("go to function or class definition") to kinda work.

    noremap &lt;buffer&gt; gD ?\(def\&lt;bar&gt;class\) &lt;c-r&gt;=expand('&lt;cword&gt;')&lt;cr&gt;\&gt;&lt;cr&gt;


== For wiki files ==

* Putting `` around a word:

    noremap &lt;buffer&gt; &lt;F1&gt; "_yiwi`&lt;esc&gt;ea`&lt;esc&gt;

* Putting `` around the selected string:

    vnoremap &lt;buffer&gt; &lt;F1&gt; &lt;esc&gt;`&gt;a`&lt;esc&gt;`&lt;lt&gt;i`&lt;esc&gt;
</pre></div>
</span><!-- postsummary -->

<div class="postbox"><!-- post hh/82 -->
<span class="postsummary" id="post_hh/82">
<span class="author">Attila Nagy</span>
<span class="subject"><span class="star">&mdash;</span></span>
<span class="tags">[+ppc]</span>
<span class="index"><a href="../hh/thread_37.html#post_hh/82">&lt;hh/82&gt;</a></span>
<span class="parent"><a href="../hh/thread_37.html#post_hh/37">&lt;&uarr;hh/37&gt;</a></span>
<span class="date">(2009-04-13)</span>
<div class="body">
<pre class="postbody">Any progress in this field recently? I'm always on the look for new
editor tips!

Btw. I use ctags only through :Tlist (what is the real name for that
plugin?), which I mapped to F8.
</pre></div>
</span><!-- postsummary -->

<div class="postbox"><!-- post hh/85 -->
<span class="postsummary" id="post_hh/85">
<span class="author">Csaba Hoch</span>
<span class="subject"><span class="star">&mdash;</span></span>
<span class="index"><a href="../hh/thread_37.html#post_hh/85">&lt;hh/85&gt;</a></span>
<span class="parent"><a href="../hh/thread_37.html#post_hh/82">&lt;&uarr;hh/82&gt;</a></span>
<span class="date">(2009-04-13)</span>
<div class="body">
<pre class="postbody"><span class="quote"><span class="quote-1">&gt; Any progress in this field recently? I'm always on the look for new
&gt; editor tips!

</span></span>Just small adjustments.

~/.vim/ftplugin/rst.vim:

    nnoremap &lt;buffer&gt; &lt;F2&gt; "_yiwi``&lt;esc&gt;ea``&lt;esc&gt;
    vnoremap &lt;buffer&gt; &lt;F2&gt; &lt;esc&gt;`&gt;a``&lt;esc&gt;`&lt;lt&gt;i``&lt;esc&gt;
    inoremap &lt;buffer&gt; &lt;F2&gt; ````&lt;left&gt;&lt;left&gt;
    setlocal tw=79
    setlocal makeprg="make html"

~/.vim/ftplugin/python.vim:

    setlocal fo+=r
    noremap &lt;buffer&gt; gD ?\(def\&lt;bar&gt;class\) &lt;c-r&gt;=expand('&lt;cword&gt;')&lt;cr&gt;\&gt;&lt;cr&gt;
    setlocal efm=\ \ File\ \"%f\"\\,\ line\ %l%m
    setlocal tw=79

<span class="quote"><span class="quote-1">&gt; Btw. I use ctags only through :Tlist (what is the real name for that
&gt; plugin?), which I mapped to F8.

</span></span>Thanks, I'll try that.
</pre></div>
</span><!-- postsummary -->

<div class="postbox"><!-- post hh/233 -->
<span class="postsummary" id="post_hh/233">
<span class="author">Csaba Hoch</span>
<span class="subject">Developing with Vim</span>
<span class="tags">[-reviewed]</span>
<span class="index"><a href="../hh/thread_37.html#post_hh/233">&lt;hh/233&gt;</a></span>
<span class="parent"><a href="../hh/thread_37.html#post_hh/85">&lt;&uarr;hh/85&gt;</a></span>
<span class="date">(2009-05-18)</span>
<div class="body">
<pre class="postbody">I'm posting the current state of my customized Vim-Heapkeeper
development environment.

== .vimrc ==

This underline feature is from Attis. I will still describe it, since
this is a public heap.

  " Underline:
  "   Underlines the current line with the given character.
  " Example:
  "   Type this line:
  "       something
  "   Type the following command while the cursor is on that line:
  "       :call Underline('-')
  "   Now the line has been underlined with '-':
  "       something
  "       ---------
  function! Underline(ch)
     let len = strlen(substitute(getline("."), ".", "x", "g"))
     normal o
     call setline(".",repeat(a:ch, len))
  endfunction

  " Concrete mappings for Heapkeeper's documentation.
  " ,&lt;char&gt;&lt;char&gt; underlines the current line with &lt;char&gt;.
  " &lt;char&gt; may be any of the followings: - = ^ " ' :

  " to be used in *.rst:
  noremap ,-- :call Underline('-')&lt;cr&gt;
  noremap ,== :call Underline('=')&lt;cr&gt;
  noremap ,^^ :call Underline('^')&lt;cr&gt;
  noremap ,"" :call Underline('"')&lt;cr&gt;
  " to be used in *.py docstring:
  noremap ,'' :call Underline("'")&lt;cr&gt;
  noremap ,:: :call Underline(":")&lt;cr&gt;

== hk/auto.vim ==

This file is automatically sourced by my vimrc when starting Vim from hk.

  " List:
  "   Lists the python files in the given directory and puts them into a new
  "   buffer in the current window. When hitting ENTER on a file, Vim will jump
  "   to that file, and the list-buffer will be deleted.
  " Examples:
  "   :List .
  "   :List       " the same as 'List .'
  "   :sp | List  " List in a new window

  " The 'List' command delegates the call to the 'HCSList' function
  command! -nargs=* List call HCSList("&lt;args&gt;")

  function! HCSList(dir)
      " new buffer
      enew
      " storing the id of this buffer (because later we should delete it)
      let g:hcs_buffer_to_delete = bufnr('%')
      " setting buffer settings
      setlocal buftype=nofile
      setlocal nobuflisted
      setlocal bufhidden=hide
      setlocal noswapfile
      " calculating the directory to be listed
      if a:dir == '' || a:dir == 's'
          let dir = '.'
      else
          let dir = a:dir
      endif
      normal dd
      " inserting the list
      exec "r!ls ".dir." | grep '\.py$'"
      normal gg
      " mapping ENTER to jump to the file under the cursor and delete the buffer
      noremap &lt;buffer&gt; &lt;cr&gt; gf:bd &lt;c-r&gt;=g:hcs_buffer_to_delete&lt;cr&gt;&lt;cr&gt;
  endfunction


  " PyDiff:
  "   Sets python-diff syntax highlight for the current file. python-diff means
  "   that the syntax highlight is the python one, except for the + and - signs
  "   in the beginning of the lines which will be blue and red. Useful when
  "   reading a diff with a lot of Python code.
  command PyDiff call PyDiff()
  function PyDiff()
      set ft=python
      syntax match x1 '^+' | hi x1 guifg=blue gui=bold
      syntax match x2 '^-' | hi x2 guifg=red gui=bold
  endfunction


  " HeapDiff:
  "   Puts a failing test assertion into two separate lines so that it is easier
  "   to stop the difference.
  " Example:
  "   $ ./test.py
  "   ======================================================================
  "   FAIL: test_TouchedPostPrinterListener (test_hkshell.Test__3)
  "   ----------------------------------------------------------------------
  "   Traceback (most recent call last):
  "     File "/a/cp/python/heap/hk/test_hkshell.py", line 379, in test_TouchedPostPrinterListener
  "       off=lambda: hkshell.remove_listener(
  "     File "/a/cp/python/heap/hk/test_hkshell.py", line 363, in _test_TouchedPostPrinter
  "       "['1']\n"])
  "   AssertionError: ['1 post has been touched:\n', "['1']\n"] != ['1 post has beentouched:\n', "['1']\n"]
  "
  "   ----------------------------------------------------------------------
  "   Ran 83 tests in 0.169s
  "
  "   FAILED (failures=1)
  "   $
  "
  "   At this point, select this text with the mouse:
  "     ['1 post has been touched:\n', "['1']\n"] != ['1 post has beentouched:\n', "['1']\n"]
  "
  "   Then switch to Vim and type ':HeapDiff'. Vim will open a new window that
  "   contains the following:
  "     ['1 post has been touched:\n', "['1']\n"]
  "     ['1 post has beentouched:\n', "['1']\n"]
  "
  "   It is easy now to spot the difference.
  command! HeapDiff call HeapDiff()
  function! HeapDiff()
      new
      set nowrap
      exec "normal \"*P"
      %s/ != /\r/
  endfunction

  " PD:
  "   Shows the modifications that were made to a file in one commit in a new
  "   window. The diff context is 9999, so basically the whole file will be
  "   shown with + and - signs. The best is to use it for Python files, since
  "   currently it sets python-diff syntax highlighting (see the PyDiff command).
  " Example:
  "   The following command shows the modifications of hkrc_attis.py in commit
  "   102f5fd:
  "     :call PD("102f5fd", "hkrc_attis.py")
  "   The whole hkrc_attis.py file is displayed, and some of the lines are
  "   prefixed with + and - signs. These lines were modified by the commit.
  command! PD call PD()
  function! PD(commit, file)
      new
      exec "normal \&lt;c-w&gt;K"
      exec "!git show ".a:commit."^:".a:file ." &gt;tmp1"
      exec "!git show ".a:commit.":".a:file ." &gt;tmp2"
      exec "r!diff -U 9999 tmp1 tmp2; echo"
      PyDiff
  endfunction

  " FM:
  "   Finds the definiton of a class or method in a Python buffer.
  " Examples:
  "   :FM Post            " class
  "   :FM from_file       " method or function
  "   :FM Post __init__   " method
  command! -nargs=* FM call FM("&lt;args&gt;")
  function! FM(arg)
      let spaceplace = match(a:arg, ' ')
      if spaceplace == -1 " the caller specified a class or a global fun
          let name1 = a:arg
          execute "silent /^ *\\(class\\|def\\) \\&lt;" . name1 . "\\&gt;"
      else " the caller specified a class and a method
          let classname = a:arg[0 : spaceplace - 1]
          let methodname = a:arg[spaceplace + 1 : -1]
          execute "silent /^ *class \\&lt;" . classname . "\\&gt;"
          execute "silent /^ *def \\&lt;" . methodname . "\\&gt;"
      endif
      normal _
  endfunction

== ~/.vim/ftplugin/python.vim ==

  " Insert '#' after I press ENTER in insert mode
  setlocal fo+=r

  " text width
  setlocal tw=79

  " Run test.py when I say :make, highlight the correct lines and enable me to
  " jump to those.
  set makeprg=./test.py
  setlocal efm=\ \ File\ \"%f\"\\,\ line\ %l%m

  " gD is normally "go to the definition of the global thing under the cursor",
  " but it does not work for Python by default. With this mapping, it does.
  noremap &lt;buffer&gt; gD ?\(def\&lt;bar&gt;class\) &lt;c-r&gt;=expand('&lt;cword&gt;')&lt;cr&gt;\&gt;&lt;cr&gt;

  " inserting ````
  nnoremap &lt;buffer&gt; &lt;F2&gt; "_yiwi``&lt;esc&gt;ea``&lt;esc&gt;
  vnoremap &lt;buffer&gt; &lt;F2&gt; &lt;esc&gt;`&gt;a``&lt;esc&gt;`&lt;lt&gt;i``&lt;esc&gt;
  inoremap &lt;buffer&gt; &lt;F2&gt; ````&lt;left&gt;&lt;left&gt;
  " in insert mode you type: class&lt;F3&gt;, the result is :class:`&lt;cursor&gt;`
  inoremap &lt;buffer&gt; &lt;F3&gt; :&lt;esc&gt;bi:&lt;esc&gt;Ea``&lt;left&gt;

== ~/.vim/ftplugin/rst.vim ==

  "text width
  setlocal tw=79

  " make
  setlocal makeprg=make\ html

  " inserting ````
  nnoremap &lt;buffer&gt; &lt;F2&gt; "_yiwi``&lt;esc&gt;ea``&lt;esc&gt;
  vnoremap &lt;buffer&gt; &lt;F2&gt; &lt;esc&gt;`&gt;a``&lt;esc&gt;`&lt;lt&gt;i``&lt;esc&gt;
  inoremap &lt;buffer&gt; &lt;F2&gt; ````&lt;left&gt;&lt;left&gt;
  " in insert mode you type: class&lt;F3&gt;, the result is :class:`&lt;cursor&gt;`
  inoremap &lt;buffer&gt; &lt;F3&gt; :&lt;esc&gt;bi:&lt;esc&gt;Ea``&lt;left&gt;
</pre></div>
</span><!-- postsummary -->

<div class="postbox"><!-- post hh/421 -->
<span class="postsummary" id="post_hh/421">
<span class="author">Attila Nagy</span>
<span class="subject"><span class="star">&mdash;</span></span>
<span class="tags">[-ppc]</span>
<span class="index"><a href="../hh/thread_37.html#post_hh/421">&lt;hh/421&gt;</a></span>
<span class="parent"><a href="../hh/thread_37.html#post_hh/233">&lt;&uarr;hh/233&gt;</a></span>
<span class="date">(2009-07-31)</span>
<div class="body">
<pre class="postbody"><span class="meta-text">[todo Remove the ppc tag from this thread; why is it there?]</span>

Cool! This post has convinced me that not only there is much to learn
about Vim, it is also worthy.

<span class="quote"><span class="quote-1">&gt; This underline feature is from Attis. I will still describe it, since
&gt; this is a public heap.

</span></span>When I designed this, I had no idea about rst, but now I see that rst
is what really makes it useful.

<span class="quote"><span class="quote-1">&gt; == hk/auto.vim ==
&gt;
&gt; This file is automatically sourced by my vimrc when starting Vim from hk.

</span></span>Does your .vimrc look for an auto.vim in whatever directory you launch
Vim from?

<span class="quote"><span class="quote-1">&gt;   " List:
&gt;   "   Lists the python files in the given directory and puts them into a new
&gt;   "   buffer in the current window. When hitting ENTER on a file, Vim will jump
&gt;   "   to that file, and the list-buffer will be deleted.

</span></span>Wow, you essentially duplicated Vim's file explorer!

<span class="quote"><span class="quote-1">&gt;   " PyDiff:
&gt;   "   Sets python-diff syntax highlight for the current file. python-diff means
&gt;   "   that the syntax highlight is the python one, except for the + and - signs
&gt;   "   in the beginning of the lines which will be blue and red. Useful when
&gt;   "   reading a diff with a lot of Python code.

</span></span>Seems useful, I think I'll import it into my environment the next
thing I do...

<span class="quote"><span class="quote-1">&gt;   " HeapDiff:
&gt;   "   Puts a failing test assertion into two separate lines so that it is easier
&gt;   "   to stop the difference.

</span></span>I had problems spotting small differences in asserts where both sides
of the `!=` were longer than 5 screen lines. But I think it would
have to be sorted out manually even with this.

<span class="quote"><span class="quote-1">&gt;   " PD:
&gt;   "   Shows the modifications that were made to a file in one commit in a new
&gt;   "   window. The diff context is 9999, so basically the whole file will be
&gt;   "   shown with + and - signs. The best is to use it for Python files, since
&gt;   "   currently it sets python-diff syntax highlighting (see the
&gt; PyDiff command).
&gt;   " Example:
&gt;   "   The following command shows the modifications of hkrc_attis.py in commit
&gt;   "   102f5fd:
&gt;   "     :call PD("102f5fd", "hkrc_attis.py")

</span></span>I like it. Elegant Git integration.

<span class="quote"><span class="quote-1">&gt;   " FM:
&gt;   "   Finds the definiton of a class or method in a Python buffer.

</span></span>Wouldn't it be nice to wire this to gD?

<span class="quote"><span class="quote-1">&gt; == ~/.vim/ftplugin/python.vim ==

</span></span>Many of these are new to me.

<span class="quote"><span class="quote-1">&gt;   " gD is normally "go to the definition of the global thing under the cursor",
&gt;   " but it does not work for Python by default. With this mapping, it does.
&gt;   noremap &lt;buffer&gt; gD ?\(def\&lt;bar&gt;class\) &lt;c-r&gt;=expand('&lt;cword&gt;')&lt;cr&gt;\&gt;&lt;cr&gt;

</span></span>Great!

Thanks for your tips!
</pre></div>
</span><!-- postsummary -->

<div class="postbox"><!-- post hh/423 -->
<span class="postsummary" id="post_hh/423">
<span class="author">Csaba Hoch</span>
<span class="subject"><span class="star">&mdash;</span></span>
<span class="index"><a href="../hh/thread_37.html#post_hh/423">&lt;hh/423&gt;</a></span>
<span class="parent"><a href="../hh/thread_37.html#post_hh/421">&lt;&uarr;hh/421&gt;</a></span>
<span class="date">(2009-07-31)</span>
<div class="body">
<pre class="postbody">== hk/auto.vim ==

<span class="quote"><span class="quote-2">&gt;&gt; This file is automatically sourced by my vimrc when starting Vim from hk.
</span></span><span class="quote"><span class="quote-1">&gt;
&gt; Does your .vimrc look for an auto.vim in whatever directory you launch
&gt; Vim from?

</span></span>Yes.

<span class="quote"><span class="quote-2">&gt;&gt;   " FM:
&gt;&gt;   "   Finds the definiton of a class or method in a Python buffer.
</span></span><span class="quote"><span class="quote-1">&gt;
&gt; Wouldn't it be nice to wire this to gD?

</span></span>Yes, it would be.
</pre></div>
</span><!-- postsummary -->
</div><!-- postbox for post hh/423 -->
</div><!-- postbox for post hh/421 -->
</div><!-- postbox for post hh/233 -->
</div><!-- postbox for post hh/85 -->
</div><!-- postbox for post hh/82 -->
</div><!-- postbox for post hh/37 -->

  </body>
</html>
